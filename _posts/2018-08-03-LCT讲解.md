---
layout: post
title:  "LCT讲解"
date:   2018-08-02 15:34:05
categories: C++ LCT
tags: C++ LCT
---

* content
{:toc}

              
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;最近自学了LCT，发现网上的资料讲解不是很全面，像我这样的蒟蒻一时半会根本理解不了。我弄了很久总算是理解了LCT，打算总结一下LCT的基本操作，还请诸位神牛来找找茬。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">如果你还没有接触过LCT，你可以先看一看这里：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">（看不懂没关系，先留个大概的印像）<a href="http://http//www.cnblogs.com/BLADEVIL/p/3510997.html" rel="nofollow" 






target="_blank">http://www.cnblogs.com/BLADEVIL/p/3510997.html</a></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">看完之后我们知道，LCT和静态的树链剖分很像。怎么说呢？这两种树形结构都是由若干条长度不等的“重链”和“轻边”构成（名字可以不同，大概就是这个意思），“重链”之间由”轻边”连接。就像这样：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><img src="https://img-blog.csdn.net/20170216113749263" alt=""><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">可以想象为一棵树被人为的砍成了一段段。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LCT和树链剖分不同的是，树链剖分的链是不会变化的，所以可以很方便的用线段树维护。但是，既然是动态树，那么树的结构形态将会发生改变，所以我们要用更加灵活的维护区间的结构来对链进行维护，不难想到Splay可以胜任。如何分离树链也是保证时间效率的关键（链的数量和长度要平衡），树链剖分的“重儿子”就体现了前人博大精深的智慧。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在这里解释一下为什么要把树砍成一条条的链：我们可以在logn的时间内维护长度为n的区间（链），所以这样可以极大的提高树上操作的时间效率。在树链剖分中，我们把一条条链放到线段树上维护。但是LCT中，由于树的形态变化，所以用能够支持合并、分离、翻转等操作的Splay维护LCT的重链（注意，单独一个节点也算是一条重链）。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这时我们注意到，LCT中的轻边信息变得无法维护。为什么呢？因为Splay只维护了重链，没有维护重链之间的轻边；而LCT中甚至连根都可以不停的变化，所以也没法用点权表示它父边的边权（父亲在变化）。所以，如果在LCT中要维护边上信息，个人认为最方便的方法应该是把边变成一个新点和两条边。这样可以把边权的信息变成点权维护，同时为了不影响，把真正的树上节点的点权变成0，就可以用维护点的方式维护边。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;</span></p>
<p><span style="font-family:'FangSong_GB2312';"><strong><span style="font-size:24px;">LCT的各种操作：</span></strong></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LCT中用Splay维护链，这些Splay叫做“辅助树“。辅助树以它上面每个节点的深度为关键字维护，就是辅助树中每个节点左儿子的深度小于当前节点的深度，当前节点的深度小于右儿子的深度。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可以把LCT认为是一个由Splay组成的森林，就像这样：（三角形代表一棵Splay，对应着LCT上一条链）</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><img src="https://img-blog.csdn.net/20170216113444978" alt=""><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">箭头是什么意思呢？箭头记录着某棵Splay对应的链向上由轻边连着哪个节点，可以想象为箭头指向“Splay&nbsp;的父亲”。但是，Splay的父亲并不记录有这个儿子，即箭头是单向的。同时，每个节点要记录它是否是它所在的Splay的根。这样，Splay构成的森林就建成了。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">这个是我的Splay节点最基本的定义：（如果要维护更多信息就像Splay维护区间那样加上更多标记）</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"></span></p>
<pre onclick="hljs.copyCode(event)"><code class="language-cpp hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>{</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> fa,ch[<span class="hljs-number">2</span>]; <span class="hljs-comment">//父亲和左右儿子。</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">bool</span> reverse,is_root;   <span class="hljs-comment">//区间反转标记、是否是所在Splay的根</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}T[maxn];</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre><br><p></p>
<br><span style="font-family:'FangSong_GB2312';font-size:18px;">LCT中基本的Splay上操作：</span>
<p></p>
<pre onclick="hljs.copyCode(event)"><code class="language-cpp hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getson</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">return</span> x==T[T[x].fa].ch[<span class="hljs-number">1</span>];</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushreverse</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span>(!x)<span class="hljs-keyword">return</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	swap(T[x].ch[<span class="hljs-number">0</span>],T[x].ch[<span class="hljs-number">1</span>]);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[x].reverse^=<span class="hljs-number">1</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span>(T[x].reverse){</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="11"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		pushreverse(T[x].ch[<span class="hljs-number">0</span>]);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="12"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		pushreverse(T[x].ch[<span class="hljs-number">1</span>]);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="13"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		T[x].reverse=<span class="hljs-literal">false</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="14"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="15"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="16"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rotate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="17"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span>(T[x].is_root)<span class="hljs-keyword">return</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="18"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> k=getson(x),fa=T[x].fa;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="19"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> fafa=T[fa].fa;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="20"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	pushdown(fa);pushdown(x);    <span class="hljs-comment">//先要下传标记</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="21"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[fa].ch[k]=T[x].ch[k^<span class="hljs-number">1</span>];</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="22"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span>(T[x].ch[k^<span class="hljs-number">1</span>])T[T[x].ch[k^<span class="hljs-number">1</span>]].fa=fa;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="23"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[x].ch[k^<span class="hljs-number">1</span>]=fa;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="24"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[fa].fa=x;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="25"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[x].fa=fafa;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="26"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span>(!T[fa].is_root)T[fafa].ch[fa==T[fafa].ch[<span class="hljs-number">1</span>]]=x;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="27"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">else</span> T[x].is_root=<span class="hljs-literal">true</span>,T[fa].is_root=<span class="hljs-literal">false</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="28"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-comment">//update(fa);update(x);    //如果维护了信息，就要更新节点</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="29"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="30"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="31"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">if</span>(!T[x].is_root)push(T[x].fa);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="32"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	pushdown(x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="33"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="34"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">Splay</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="35"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	push(x);   <span class="hljs-comment">//在Splay到根之前，必须先传完反转标记</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="36"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> fa;!T[x].is_root;rotate(x)){</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="37"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-keyword">if</span>(!T[fa=T[x].fa].is_root){</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="38"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">			rotate((getson(x)==getson(fa))?fa:x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="39"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="40"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	}</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="41"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre><br><br><p></p>
<span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span><br><p></p>
<span style="font-family:'FangSong_GB2312';"><br><br></span>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">access操作：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">这是LCT最核心的操作。其他所有操作都要用到它。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">他的含义是”访问某节点“。作用是：对于访问的节点x，打通一条从树根（真实的LCT树）到x的重链；如果x往下是重链，那么把x往下的重边改成轻边。可以理解为专门开辟一条x到根的路径，由一棵Splay维护这条路径。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">access之前：（粗的是重链）&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; access之后：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;<img src="https://img-blog.csdn.net/20170216114227567" alt=""><img src="https://img-blog.csdn.net/20170216114233712" alt=""></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">access实现的方式很简单；</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 先把x旋转到所在Splay的根，然后把x的右孩子的is_root设为true（此时右孩子对应的是x下方的重链，这样就断开了x和下方的重链）。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 用y记录上一次的x（初始化y=0），把y接到x的右孩子上，这样就把上一次的重链接到了当前重链一起，同时记得T[y].is_root=false。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 记录y=x，然后x=T[x].fa，把x上提。重复上面的步骤直到x=0。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">代码：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"></span></p>
<pre onclick="hljs.copyCode(event)"><code class="language-cpp hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">access</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">int</span> y=<span class="hljs-number">0</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-keyword">do</span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		Splay(x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		T[T[x].ch[<span class="hljs-number">1</span>]].is_root=<span class="hljs-literal">true</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		T[T[x].ch[<span class="hljs-number">1</span>]=y].is_root=<span class="hljs-literal">false</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		<span class="hljs-comment">//update(x);    //如果维护了信息记得更新。</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">		x=T[y=x].fa;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="9"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	}<span class="hljs-keyword">while</span>(x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="10"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre><br><p></p>
<p></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">mroot操作：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个操作的作用是把某个节点变成树根（这里的根指的是整棵LCT的根）。加上access操作，就可以方便的提取出LCT上两点之间的路径。提取u到v的路径只需要mroot(u),access(v),然后v所在的Splay对应的链就是u到v的路径。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">mroot实现的方式：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 由于LCT是Splay组成的森林，所以要把x变成根就只需要让所有Splay的父亲最终指向x所在Splay。所以先access(x),Splay(x)，把现在的根和将成为根的x链在一棵Splay中，并转到根即可。但是我们注意到，由于x成为了新的根，所以它和原来的根所在的Splay中深度作为关键字的性质遭到了破坏：新根x应该是Splay中深度最小的，但是之前的操作并不会改变x的深度（也就是目前x依旧是当前Splay中深度最深的）。所以，我们需要把所在的这棵Splay翻转过来。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">（粗的是重链，y是原来的根）</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">翻转前：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 翻转后：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;<img src="https://img-blog.csdn.net/20170216114931469" alt=""><img src="https://img-blog.csdn.net/20170216114945326" alt=""></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">这时候x才真正变成了根。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">代码：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"></span></p>
<pre onclick="hljs.copyCode(event)"><code class="language-cpp hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">mroot</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	access(x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	Splay(x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	pushreverse(x);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre><br><br><span style="font-family:'FangSong_GB2312';font-size:18px;"></span>
<p></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">link操作：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">这个操作的作用是连接两棵LCT。对于link(u,v)，表示连接u所在的LCT和v所在的LCT；</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">link实现的方式：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">很简单，只需要先mroot(u),然后记录T[u].fa=v就可以了，就是把一个Splay森林连到另一个上。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">代码：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"></span></p>
<pre onclick="hljs.copyCode(event)"><code class="language-cpp hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">link</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u,<span class="hljs-keyword">int</span> v)</span></span>{</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	mroot(u);</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[u].fa=v;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre><br><p></p>
<br><p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">cut操作：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 这个操作的作用是分离出两棵LCT。</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;">代码：</span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"></span></p>
<pre onclick="hljs.copyCode(event)"><code class="language-cpp hljs"><ol class="hljs-ln"><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="1"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">cut</span><span class="hljs-params">(<span class="hljs-keyword">int</span> u,<span class="hljs-keyword">int</span> v)</span></span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="2"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-title">mroot</span><span class="hljs-params">(u)</span>;   <span class="hljs-comment">//先把u变成根</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="3"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	access(v);Splay(v);    <span class="hljs-comment">//连接u、v</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="4"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	pushdown(v);     <span class="hljs-comment">//先下传标记</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="5"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	T[u].fa=T[v].ch[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>;</div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="6"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-comment">//v的左孩子表示v上方相连的重链</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="7"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">	<span class="hljs-comment">//update(v);  //记得维护信息</span></div></div></li><li><div class="hljs-ln-numbers"><div class="hljs-ln-line hljs-ln-n" data-line-number="8"></div></div><div class="hljs-ln-code"><div class="hljs-ln-line">}</div></div></li></ol></code><div class="hljs-button" data-title="复制"></div></pre><br><p></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-family:'FangSong_GB2312';font-size:18px;"><br></span></p>
<p><span style="font-size:18px;">这些就是<span style="font-family:Calibri;">LCT</span><span style="font-family:'宋体';">的基本操作。我推荐几个</span><span style="font-family:Calibri;">LCT</span><span style="font-family:'宋体';">的练习题：</span></span></p>
<p><span style="font-family:'宋体';font-size:18px;"><br></span></p>
<p><span style="font-size:18px;">bzoj2049&nbsp;SDOI2008<span style="font-family:'宋体';">洞穴勘探</span></span></p>
<p><span style="font-size:18px;">模板题，只需要<span style="font-family:Calibri;">link</span><span style="font-family:'宋体';">和</span><span style="font-family:Calibri;">cut</span><span style="font-family:'宋体';">，然后询问连通性。题解：</span></span></p>
<p><span style="font-size:18px;"><a href="http://blog.csdn.net/saramanda/article/details/55210235" rel="nofollow" target="_blank"><u><span>http://blog.csdn.net/saramanda/article/details/55210235</span></u></a></span></p>
<p><span style="font-size:18px;"><a href="http://blog.csdn.net/saramanda/article/details/55210235" rel="nofollow" target="_blank"><u><span><br></span></u></a></span></p>
<p><span style="font-size:18px;">bzoj2002&nbsp;HNOI2010<span style="font-family:'宋体';">弹飞绵羊</span></span></p>
<p><span style="font-size:18px;">模板题，需要<span style="font-family:Calibri;">link</span><span style="font-family:'宋体';">和询问某点到根的路径长度。题解：</span></span></p>
<p><span style="font-size:18px;"><u><span>http://blog.csdn.net/saramanda/article/details/55210418</span></u></span></p>
<p><span style="font-size:18px;"><u><span><br></span></u></span></p>
<p><span style="font-size:18px;">bzoj3669&nbsp;NOI2014<span style="font-family:'宋体';">魔法森林</span></span></p>
<p><span style="font-size:18px;">LCT<span style="font-family:'宋体';">的综合应用。题解：</span></span></p>
<p><span style="font-size:18px;"><a href="http://blog.csdn.net/saramanda/article/details/55250852" rel="nofollow" target="_blank"><u><span>http://blog.csdn.net/saramanda/article/details/55250852</span></u></a></span></p>
            </div>
                